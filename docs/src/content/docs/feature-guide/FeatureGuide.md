---
title: Feature Guide
description: DYA Dash features
sidebar:
  order: 0
---

DYA Dash を使ったりソフトウェアを改造したりする上で知っておくと良さそうな内容を走り書きしたページです。

:::note

このページは現在 V2 向けに書かれています。

:::

## 左右の役割

- 右手側のキーボードが親機として動きます。PC と有線接続する場合は右側の XIAO に USB ケーブルを接続してください。
- 左手側のキーボードは子機として右手のキーボードと通信しています。左手の XAIO に USB ケーブルを接続した場合は電源供給のみが行われます。
- キーボードには　 XAIO の USB ポートに加えて左右接続用の USB ポートがありますが、有線での左右接続にはまだ未対応です。今のところ電源供給（XIAO の USB ポートから入力された電源をもう片方のキーボードにバイパスする）用途でのみ使用できます。

## デフォルトのキー配列

[デフォルトキーマップ](/dya-dash-keyboard/feature-guide/default_keymap) に移動しました

## ファームウェアのビルド方法

以下のレポジトリにコードがあります。README の説明を読んでください。

https://github.com/cormoran/zmk-keyboard-dya-dash

キーマップの変更は [キーマップのカスタマイズ](/dya-dash-keyboard/feature-guide/customize_keymap) を見てください。

## 電池持ちなど

以下の記事でより詳しい Power profile 結果を解説しています。回路は V1 のものを使用したので V2 では少しだけ状況が変わっている可能性があります。

- [XIAO nrf52840 と ZMK を使ったキーボードのスリープ時消費電力](https://note.com/cormoran/n/n72a9d815ed55)
- [XIAO nrf52840 と ZMK を使ったトラックボールキーボード使用時の消費電力](https://note.com/cormoran/n/n7cd3f64d9a13)

電池残量については [バッテリー残量表示](/dya-dash-keyboard/feature-guide/battery/)をご覧ください。

### 電源回路の補足

DAY Dash の電源回路では電池の電圧を 3.3V まで昇圧しています。電池の電圧が 1V を下回ると昇圧回路がオフになるように設計していますが、電池電圧の測定などの部分で微弱な電流が流れ続けます。電流が流れ続けると過放電の状態になるので、動かなくなるまで使い切るのではなく、電池残量が減ったら電池交換することをお勧めします。

また、電源回路には USB の電源が電池の方向に流れないようにする逆流防止回路を組み込んでいます。そのため USB 接続している時に電池の電源スイッチをオンにしても大丈夫なはずです。
一応逆流防止がうまく動いてそうなことは確認できていますが、作者は電子回路のプロではないのでうまく動かないケースがあるのではないかと少し心配しています。
なお、実装している逆流防止回路は XIAO の USB 電源回路と合わさって初めてうまく動くような設計になっています。他のマイコン（e.g. RP2040-Zero）で同じような回路を組んでもうまく動かないと思うので真似したい人は注意してください。

V2 回路では、電池を間違って逆に接続してしまった時の保護回路を追加しました。

### LED の輝度

基板に付いている４つの LED を全力（RGB=255,255,255）で点灯させると電池に 1A 以上の電流が流れました。
（昇圧後の部分に流れている電流はもっと少ない気がしますが）回路の配線パターンは大電流を流すことをあまり考えていないため、LED を全力で点灯させていると発熱したり、最悪配線パターンが焼き切れる可能性があります。
デフォルトのソフトウェアでは最大輝度を制限していますが、ソフトウェアを改造する人は LED の輝度はほどほどにしてください。（光らせすぎると目もくらみますし...）

### バッテリー残量の予測

[バッテリー残量表示](/dya-dash-keyboard/feature-guide/battery/)をご覧ください。

バッテリー残量はニッケル水素電池の電圧パターンを chat GPT に教えてもらって雑に区分線形関数近似で実現しています。
アルカリ乾電池などを常用する場合は、以下の値を変えてビルドするともっともらしい残量表示になります。

https://github.com/cormoran/dya-dash-keyboard/blob/27277f3221aaf06a4fc788ebab543c700398413d/firmware/zmk-module/zmk-keyboard-dya-dash/boards/shields/dya_dash/dya_dash.dtsi#L154

## 裏面マグネット

持ち運び時に便利なように左右のキーボードはマグネットで合わせられるようになっています。

## タッチセンサー

### 感度

タッチセンサーの感度は最大の状態になっています。もし感度が高すぎる場合は、基板にコンデンサを取り付けることで調整することが可能です。
調整するつもりでコンデンサーをつけない状態にしておいたのですが、そのままでなんか良さそうなので未調整の状態です。

### 余りのポート

両方の基板に、親指付近と中指上付近にタッチセンサーの余っている２ポートにつながるパッドがあります。

動作未検証（少し無理して配線を伸ばしているので静電容量検知がうまくいかないかも）ですが、動きそうなら改造して遊んでもらえるのではないかと思います。

## 左右の有線接続

トラックボールセンサーのモーション入力とキーボードの左右有線通信を共用するような回路設計をしているのでうまくいけば有線通信が実装できます。

- V1 基板では抵抗値の選定ミスで有線通信ができなさそうな状態です。
- V2 基板では多分できる気がする状態に修正しましたが、まだ動作未確認でできるかどうかわからない状態です。

ZMK では左右有線接続機能が現在絶賛開発進行中ですが、Dya Dash に適用するためには少し改造が必須になるので作者の時間が取れるのを待っている状態です。
